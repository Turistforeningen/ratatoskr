secrets:
  image: 'turistforeningen/ratatoskr-secrets:v2'
  tags:
    - app
  volumes:
    - /secrets

ratatoskr-node:
  autoredeploy: true
  environment:
    - FORCE_SSL=true
    - HSTS_MAX_AGE=31536000
    - NODE_ENV=production
    - STATSD_HOST=statsd
    - STATSD_PORT=8125
    - 'VIRTUAL_HOST=http://medlem.dnt.no*,https://medlem.dnt.no*'
    - VIRTUAL_HOST_WEIGHT=20
    - VIRTUAL_PATH=/
    - VIRTUAL_PORT=8080
  expose:
    - '8080'
  image: 'turistforeningen/ratatoskr'
  links:
    - 'statsd.statsd-librato:statsd'
    - 'ratatoskr-redis:redis'
  restart: always
  command: node server/index.js
  tags:
    - app
  volumes_from:
    - 'secrets:ro'

ratatoskr-redis:
  autoredeploy: true
  command: redis-server --appendonly yes
  image: 'redis:3.0'
  restart: on-failure
  tags:
    - app
